QoS(Quality of Service)ネットワーク場でサービスの品質を保つための技術

①ベストエフォート　パケットの優先順位を考えず、先に来たものを先に出す処理。通信品質は保証されない。QoSのデフォルトはベストエフォート。

②IntServ(Integrated Services)必要となる帯域をあらかじめ確保しておくもの。RSVPというプロトコルを用いる。規模が大きくなると負荷が大きくなりすぎる。

③DiffServ(Differentiated Services)各ルータやスイッチごとに届いたパケットの優先順位に基づいて区別して転送処理をする。QoSで最も採用される。


DiffServモデル通信の流れ
①分類　届いたパケットの種類からクラスと呼ばれるカテゴリに分類する。

②マーキング　分類されたパケットに優先度を識別するための印をつける。

③キューイング　パケットにつけられたマークから優先度に応じてキューに並べていく。
　　>キュー　データ構造の一つで、届いたデータを格納しておく入れ物のようなもの

④スケジューリング　各キューから優先度に応じてデータを取り出して送信する。


キューイング方式
　>FIFO(First-In First-Out)デフォルトのキューイング方式。届いた順に先入先出しする。

　>PQ(Priority Queuing)優先度の異なるキューを４つ用意して、最も優先度が高いパケットを完全に優先して送信する方式。

　>WFQ(Weighted Fair Queuing)フローごとにキューを作成し、自動管理する方式。優先度が高いパケットは多めに、低いパケットは少なめに転送する。

　>CB-WFQ(Class-Based WFQ)クラスごとにキューを割り当てる方式。クラスごとに最低保証帯域幅の指定が可能。

　>LLQ(Low Latency Queuing)PQとCBWFQの２つを使用するキューイング方式。優先度が高いパケットも転送しつつ、優先度が低いパケットもある程度転送する。

　>CQ(Custom Queuing)キューごとに定義したバイト数ずつパケットを転送する方式。


輻輳回避　輻輳によって起こるテールドロップを防ぐためにキューに待機しているパケットを破壊すること。
　>テールドロップ　キューがいっぱいになったときに、それ以降に届いたパケットは全て破棄してしまうこと。

　>RED(Random Early Detection)ランダム早期検出。キューがいっぱいになる前に、パケットをランダムで破壊する方式。ランダムのため、優先度の高いパケットも破棄される可能性があるというリスクがある。

　>WRED(Weighted RED)重みづけランダム早期検出　キューがいっぱいになる前に、優先順位が低いパケットから破棄する方式。


帯域制御　特定の基準をもとに使用できるデータ転送量や通信速度を制限すること。WAN環境でよく使われる。

　>シェーピング　主にデータを送信する側で実装するもので、決められた制限レートを超えるパケットは一旦キューに保持しておいて、送信可能になったタイミングで送信するもの。遅延やジッタという通信の揺れや乱れの発生の原因にもなってしまう。

　>ポリシング　主にネットワークの入り口部分で実装するもので、制限レートを超えるパケットは破棄される。損失が起こる原因ではあるが、遅延やジッタは発生しない。直前までの転送データ量が少ない場合、制限レートを超えても送信が許可されることもある。