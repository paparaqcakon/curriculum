2-1
SOHO(small office/home office) 小さいオフィスや自宅でパソコンなどを活用して行う働き方のこと。

2-2
イーサネットフレームのうち、プリアンブル{8byte}は物理ヘッダという。
宛先MACアドレス{6byte}　送信元MACアドレス{6byte}
タイプ部{2byte}　ノード間ではなく各階層間でのデータ受け渡しに関係する。単語の定義としては上位層のプロトコルを識別する番号になる。
データ{46~1500byte}
トレーラはFCS｛4byte｝を格納している。(Frame Check Sequence)データの誤りがないか調べるため、送信時にデータに付加される誤り検出符号のこと。
フレーム全体から一定の計算をもとに算出したデータで、受信側は同じ計算を行い同じ値が出るかどうかで内容の破損などがあるかどうかの判断ができる。
一致しない場合は送信側にエラーを通知して再送を要求する。

2-6 VLAN基本
VLAN1とVLAN1002~1005が最初から作成済みで、削除することができない。
すべてのポートはまずVLAN1に所属していることからデフォルトVLANと呼ばれている。
[ネイティブVLAN]　タグVLANにおいて、トランクリンク上で唯一タグをつけずに送受信されるVLANのこと。初期はVLAN 1。
{現状全てのVLANはタグ方式なのか？}

[スタティックVLAN]スイッチポートごとに管理者が手動でVLANを割り当てるVLAN。一般的な方式。
[ダイナミックVLAN]接続するデバイスによって動的に所属するVLANを変更できるVLAN。コレを利用するためには、各PCのMACアドレスがどのVLANに所属するかの定義をVMPS(VLAN MAnagement Policy Server)で保持する。{MACアドレステーブルのようなもの}
※実際は802.1x認証ポートで、ADと連携してユーザー,グループ,OU名に応じてVLANを割り当てる手法が一般的※https://www.infraexpert.com/study/vlanz2.html

アクセスポート　1つのVLANに対応するポート　おもにPCを接続するポート
トランクポート　複数のVLANに対応するポート　おもにネットワークデバイス同士を接続するポート
[トランク]　木の幹、胴体、主要な、(旅行用の)大型カバン

DTP(Dynamic Trunking Protocol) 	スイッチのポートを動的にアクセスポートかトランクポートに決定するCisco独自のプロトコル

ネゴシエーション　ケーブルでデバイス同士が接続された瞬間に、2つのデバイスが情報交換をしてどのような通信を行うか決定する一連の流れ

Accessモード　自身を無条件にアクセスポートにするモード　相手に関係ない　相手がトランクポートの場合通信できない
Trunkモード　自身を無条件にトランクポートにするモード　相手に対してトランクポートにしようと働きかけるが、相手がアクセスポートの場合変えられない。
Dynamic auto モード　相手によって自動でポートを決めるモード　アクセスポートのまま、相手を受け入れる。したがってお互いダイナミックオートの場合は両者がアクセスモードとなる。
Dynamic desirableモード　相手にトランクポートを勧める。　トランクポートのまま、あいての反応を待つ。相手がアクセスモードなら自身もアクセスモードになる。


2-8　VLAN関連用語　
トランキングプロトコル　タグVLANで付加するプロトコル　IEEE 802.1Q　と　ISLの２つがある

IEEE 802.1Q　ドットワンキューともドットイチキューとも呼ばれる　イーサネットフレームのMACアドレスとタイプ部の間に4バイトのタグを付加する方式
内訳は　TPID(Tag Protocol Identifer)　16ビット　.1qフレームであることを受信側に示す　0x8100の値が入る
　　　　PCP(Priority Code Point)　3ビット　.1qで定義されたフレームの優先度を示す情報　0~7の値が入る
　　　　CFI(Canonical Format Indicator)　1ビット　アドレス形式を示す　イーサネットの場合0の値が入る
　　　　VID(VLAN Identifier)　12ビット　VLAN IDを示す　0~4095の値が入る
付加されるフレームサイズは4バイトのため、これによるイーサネットフレームサイズは最大1522バイト

ISL(Inter Switch Link)　Cisco独自のプロトコル　イーサネットフレームをISLヘッダとFCSで囲むことからカプセル化方式とも
ISLヘッダ(タグ)は26バイト　その中の一部でVLAN IDが示されている　FCSは4バイト
付加されるフレームサイズは30バイトのため、これによるイーサネットフレームサイズは最大1548バイト

試験ではこんなコマンドも...
(Config-if)#switchport trunk encapsulation [dot1qもしくはisl]
トランキングプロトコルの設定してんやなって。


2-9　
音声VLAN 　IP PhoneとPCを別々のVALNにする機能。音声データにVLAN IDでタグ付けする機能。PCはデータ自体にVLAN IDの付加をしないため、スイッチでは音声かデータかを区別するために分離した方が効率が良い。


[CDP](Sisco Discovery Protocol) Cisco独自のプロトコル。L2にてフレームの交換で動作する。直接リンクしたノード同士で、お互いのどのポートにどの機器が接続されているかを検出するプロトコル。ここから正しい配線かどうかも判断できる。SNAPをサポートしているLANで利用できる。

[SNAP](Subnetwork Access Protocol) IEEE802.2で定義される通信プロトコル。L3のプロトコルを識別するために機能する。L2にてSNAPヘッダとして付加される。通常Ethernet Ⅱに代わるフレームとして使用される。基本的にはLAN内で利用される技術だが、FDDIやATM(Asynchronous Transfer Mode)といった他のネットワークでもコレを使うことがある。

[FDDI](Fiber Distributed Data Interface) 1980~1990年ごろに利用されていた、光ファイバーを使ったトークンパッシングを利用した100MbpsのLAN規格。Ethernet規格の高速化と普及によって廃れていった。

[ATM](Asynchronous Transfer Mode)非同期転送モード。広域通信網などで利用される通信プロトコルの一種。常に同期させる回線と異なり、送信する必要がある時のみ通信を行う。そのためLANをより高速に運用できるとされる。　TCP/IPでよく利用される。L2で動作するプロトコル。{サイトによって廃れてたり注目されてたりマチマチ}

音声VLANでよく使うコマンド
(Config-if)#switchport mode access　　　　音声VLANはアクセスポート限定。
(Config-if)#switchport voice vlan 番号　　音声用のVLANを指定。
(Config-if)#switchport access valn 番号　　PC用のVLANを指定。


VTP(VLAN Trunking protocol)一台のスイッチに対してVLANの追加,名前変更,削除をすると、VTPドメイン内全てのCatalystスイッチにその情報の同期をするプロトコル。VTPドメイン名を一致させる必要がある。.1qとisl両方利用できる。

[VTPアドバタイズメント]　VTPで同期するために送信されるメッセージ。トランクポートでのみ伝播される。

[Catalystスイッチ]　Ciscoが製造しているスイッチのシリーズ名

　サーバモード　VLAN情報を同期するモード。VLANの作成と削除ができる。
　クライアントモード　VLAN情報を同期するモード。VLANの作成と削除はできない。
　トランスペアレントモード　VLAN情報を同期しないモード。VLANの作成と削除ができる。
いずれもトランクポートでのみ有効。

トランスペアレントは同期しないだけで、VLAN情報の転送は行う。
そのため、サーバーモード＝＝トランスペアレント＝＝クライアント
という配置でもサーバモードの変更はクライアントモードのスイッチに問題なく反映される。

リビジョン番号　VLANの設定変更があるたびに1ずつ増えていく数値。　つまりリビジョン番号が一番大きなものが最新であるため、それを同期させる。トランスペアレントではコレは増えない常に0。

　　すでにVLAN設定をしてあるスイッチをVTPドメインに追加し同期されると、「「すでにあるVLAN設定が消えて現在のVTP内の設定に上書きされてしまう」」という最大の欠点がある。一応トランスペアレントで回避できる{けど使いづらそう}


2-10　STPの基本
冗長化　PCやシステムの予備を準備すること。L2ではデータ転送経路の選択を増やすことを指す。

ブロードキャストストーム　ブロードキャスト用のデータが際限なく転送され、ループされる現象。冗長構造のネットワークで発生する。

STP(Spanning Tree Protocol) スパニングツリープロトコル　冗長構造でループを防ぐためにできた機能。論理的にツリートポロジーにする。IEEE802.1Dで標準化されたプロトコル。


2-11 STP 仕組み
[STA](Spanning tree algorithm)以下に示す、STPを機能させるための作業手順。

ルートブリッジ　L2ネットワークのうち、1つだけ選出される親となるスイッチ。一番の上流となる。

RP(Root Port)ルートポート　ルートブリッジに最も近いポート　ルートブリッジ以外の各スイッチにおいて1つのポートがルートポートになる。
DP(Designated Port)指定ポート　各コリジョンドメインでルートブリッジに最も近いポート　各コリジョンドメイン内で１つのポートが指定される。
BP(Blocking Port)ブロッキングポート　ルートにも指定にも選出されなかったポート。非指定ポート(NDP)とも呼ばれ、コレを使ってブロードキャストストームを防ぐ。

役割の選出方法
BPDU(Bridge Protocok Data Unit)　STPを実装しているスイッチ間で情報を交換するために利用するフレーム。
　ルートブリッジのブリッジID(ルートID)
　ブリッジID
　ルートパスコスト
　ポ-トID
　Hello Time (BPDUの送信間隔)
BPDUは以上5つの情報を記載されており、コレで隣接スイッチと比較する。

①　ルートブリッジの選出
　ブリッジID　STPのルートブリッジを選出するために用いられるID。ブリッジプライオリティとMACアドレスで構成される。IDの値が小さいほど優先度が高い。
　ブリッジプライオリティ　16ビットで構成されるスイッチの優先度を表す値。　
　　仮に、プライオリティが同値なら、MACアドレスの小さいほうが選出される。

②　ルートポートの選出　「最も近いというのは物理的な距離ではなく、たどり着くまでのコストで考える。」
ルートパスコスト　ルートブリッジまでのポートパスコストの総和
ポートパスコスト　ポートが動作している速度によって求められる値
ショートパスコスト　ポートパスコストの通常の算出方法
それぞれ値が小さいほど速度が速いということになる。
例　10Mbps=100 　　100Mbos=19　　1Gbps=4　　10Gbps=2　(ポート速度=ショートパスコスト)
　　仮に、ルートパスコストが同値なら送信元のブリッジIDの小さいほうをルートパスコストの最小経路として扱う。

③　指定ポートの選出
　指定ポートのルール
　　ルートブリッジのすべてのポートは必ず指定ポートになる
　　ルートポートの向かいのぽーとは必ず指定ポートになる
　　各コリジョンドメインごとに1つ指定ポートが存在する
仮に、上記三つのルールで指定できない場合は、ブリッジIDの小さいほうを指定ポートとして扱う。

④　ブロッキングポートもしくは非指定ポートの検出
ルートポートのと指定ポートの選出が終わった後に何の役割も与えられていないものがコレ

{ルートポートで障害が発生すると、再度役割を選出し直す。}

[downlink]上流から下流向けて発信されるデータや電波のこと。ここではルートブリッジを最上流として、指定ポートがダウンリンクとなる。
[uplink]下流から上流に向けて発信されるデータや電波のこと。ここではルートブリッジを最上流として、ルートポートがアップリンクとなる。

[Loop Detection] L2のループを検知すると、ポートを一時的にシャットダウンさせてループ解消させる。ループが根本的に解消した場合、通信を復旧させることもできる。

※Loop detectionがあるため、STPはループ防止というより冗長化を目的とすると考えることもできる。
※https://milestone-of-se.nesuke.com/nw-basic/stp/stp-summary/


2-12　STP関連用語
STP(spanning Tree Protocol) 基本の規格　IEEE802.1dで定められている。遅い。
RSTP(Rapid STP) STPをより高速化した規格　STPよりも収束までの時間が短縮されている　IEEE802.1wで定められている。STPにおいて収束まで50秒ほどかかるのに対して、コレは数秒で済む。BPDUv2というフレームを利用する。
MSTP(Multiple STP)　RSPTを拡張した規格　VLAN環境での動作を考慮されている　IEEE802.1sで定められいる

Convergence 収束　ここではBPDUによってルートブリッジや各ポートの役割をすべて選出した状態

各スイッチが物理的に接続されてから収束するまで
　０．Disable ディゼーブル　ポートがshutdownされている状態。パケットやBPDUを一切転送しないため、この状態から他の状態に遷移することはない。
　１．Blocking ブロッキング　フレームを転送せず、BPDUの受信のみ行う状態。shutdownされていないすべてのポートはブロッキング状態からスタート。BPDUの受信がなくなったことを確認すると、リスニング状態に遷移する。
　２．Listening リスニング　BPDUを送受信しルートブリッジや各ポートの役割選出を行っている状態。データの転送は行わない。一定の待機時間後(15秒)、ラーニングもしくはブロッキングに移行する
　３．Learning ラーニング　BPDUを送受信し、非指定ポートになった際には即座にブロッキング状態に移行する。一定の待機時間後(15秒)、フォワーディング状態に移行する。MACアドレス学習はするが、データの転送はしない。
　４．Forwarding フォワーディング　ポートがルートポートまたは指定ポートになった状態。この状態になったポートはデータの転送をするようになる。MACアドレス学習できる。

STPにおいて、ルートブリッジは2秒ごとにBPDUを下流のスイッチに送信している。下流のスイッチはBPDUを20秒受信できなくなると障害発生とみなし、リスニング状態になり役割選出を再度行う。

[Hello Time](2秒)　スイッチのBPDUの送信間隔。
[Max Age](20秒)　BPDUを受信しなくなり、障害発生とみなすまでの時間。
[Forward Delay](15秒)　リスニング状態、ラーニング状態に留まる時間。
これらの時間は一応変更可能らしいが、非推奨。https://www.infraexpert.com/study/stpz3.html

RSTPでは１〜２をまとめてディスカーディングと呼ぶ。

インスタンス　スパニングツリーの構成方法のこと。ネットワークにおける論理的トポロジのこと。
　CST(Common Spanning Tree) VLANの数に関係なく1つにインスタンスを構成する。VLAＮごとに分けていないため負荷分散できない。STPとRSTPを示す。
　PVST+(Per-VLAN Spanning Tree Plus)　VLANごとにインスタンスを構成する。CSTと異なり、負荷分散が柔軟に行える。
　MST(Multiple Spanning Tree)　複数のVLANを1つのグループにまとめてインスタンスを構成する。PVST+同様負荷分散ができる。
 [IST](Internal Spanning Tree) MSTリージョン内にデフォルト内に存在するインスタンス０。リージョン内に複数のインスタンスがあった場合でも、インスタンス0がBPDUを送受信する。https://beginners-network.com/supplement/ist_cst_cist.html#:~:text=CST(Common%20Spanning%20Tree)は,部分はCSTとなります%E3%80%82
 [Rapid PVST+] PVST+の収束が速いインスタンス。
 [CIST](Common and Internal Spanning Tree) ISTとCST全体のスパニングツリー構成を示す。

つまりVLANがないならCST、あればPVST+となる。MSTはPVST+をまとめる機能を追加したもの。

RSPTの各ポート役割選出　STPとは少し異なる｛ブリッジポートの選出は同じか？｝
　①RP(Root Port)ルートポート　これはSTPと同じ
　②DP(Designated Port)指定ポート　これもSTPと同じ
　③AP(Alternate Port)代替ポート　ルートポートのバックアップ用のポート。RPがダウンしたとき、RPの役割を引き継いでフォワーディングとなる。STPにおける非指定ポート。
　④BP(Backup Port)バックアップポート　DPのバックアップ用のポート。DPがダウンしたとき、DPの役割を引き継いで、フォワーディングとなる。
{バックアップポートとブロッキングポートの略称が両方ＢＰ！！ＢＰ！！ＢＰ！！}

STPの機能
　Portfast　スパニングツリーの計算をせず、即座にデータの送受信を可能にする機能
　UplinkFast　直接的な障害の収束を早める機能。
　BackboneFast　間接的な障害の収束を早める機能。
　ルートガード　上位のBPDUを受診したポートを使用不可にすることで、想定外のスイッチがルートブリッジになってしまうことを防ぐ機能。
　BPDUガード　PortFastが有効になっているポートで危機をご接続することで起こるブロードキャストを防ぐ機能。
　BPDUフィルタリング　BPDUの送受信を止める機能。
　

2-13　リンクアグリゲーション

リンクアグリゲーション　複数の物理リンクを一つの論理的リンクとしてまとめることで、通信速度と可用性を高める技術。
Ether Channel リンクアグリゲーションのCisco独自の呼称

LACP(Link Aggregation Control Protocol)リンクアグリゲーションにおけるネゴシエーションプロトコル。
IEEE802.3adにて標準化されている。非Ciscoデバイスとの接続で利用できる

PAgP(Port Aggregation Protocol) Ether Channelにおけるネゴシエーションプロトコル。Ciscoデバイスとだけ利用できる。

モード
on　手動で無条件にEtherChannelを形成する。{つまりシスコ機器限定か？}ネゴシエーションはしない。
PAgP atuo 相手からPAgPネゴシエーションを受信し、Ether Channelを形成するモード。auto同士だとEther Channelを形成しない。
PAgP desirable 相手にPAgPネゴシエーションを送信し、Ether Channelを形成するモード。desirable同士でも形成できる。
LACP passive 相手かLACPネゴシエーションを受信し、リンクアグリゲーションを形成するモード。passive同士だと形成しない。
LACP active 相手にLACPネゴシエーションを送信し、リンクアグリゲーションを形成する。相手がactiveでも形成する。







　
